<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:TagWriter.UI.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:views="using:TagWriter.UI.Views"
        mc:Ignorable="d" d:DesignWidth="400" d:DesignHeight="450"
        x:Class="TagWriter.UI.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="{Binding Title}"
        WindowStartupLocation="CenterScreen"
        Background="#f0f2f5"
        Width="800" Height="500" 
        ExtendClientAreaToDecorationsHint="True"
        ExtendClientAreaChromeHints="NoChrome"
        ExtendClientAreaTitleBarHeightHint="-1">

    <Design.DataContext>
        <!-- This only sets the DataContext for the previewer in an IDE,
             to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Border Background="White" 
            CornerRadius="8" 
            Margin="10">
        <Border.Effect>
            <DropShadowEffect BlurRadius="8" 
                            Color="#20000000" 
                            OffsetX="0" 
                            OffsetY="4"/>
        </Border.Effect>
        <Grid RowDefinitions="Auto,*,Auto">
            <!-- 顶部标题栏 -->
            <Border Grid.Row="0" 
                    Background="#1890ff" 
                    Height="50"
                    CornerRadius="8,8,0,0">
                <Grid ColumnDefinitions="*,Auto">
                    <TextBlock Text="{Binding Title}"
                              Foreground="White"
                              VerticalAlignment="Center"
                              Margin="20,0"
                              FontSize="16"/>
                    
                    <!-- 右侧窗口控制按钮 -->
                    <StackPanel Grid.Column="1" 
                                Orientation="Horizontal" 
                                Spacing="8"
                                Margin="0,0,8,0">
                        <Button Command="{Binding MinimizeWindowCommand}"
                                CommandParameter="{Binding $parent[Window]}"
                                Width="40"
                                Height="30"
                                Background="Transparent"
                                CornerRadius="4"
                                Padding="0"
                                VerticalContentAlignment="Center"
                                HorizontalContentAlignment="Center">
                            <TextBlock Text="—" 
                                     Foreground="White"/>
                        </Button>
                        <Button Command="{Binding MaximizeWindowCommand}"
                                CommandParameter="{Binding $parent[Window]}"
                                Width="40"
                                Height="30"
                                Background="Transparent"
                                CornerRadius="4"
                                Padding="0"
                                VerticalContentAlignment="Center"
                                HorizontalContentAlignment="Center">
                            <TextBlock Text="□" 
                                     Foreground="White"/>
                        </Button>
                        <Button Command="{Binding CloseWindowCommand}"
                                CommandParameter="{Binding $parent[Window]}"
                                Width="40"
                                Height="30"
                                Background="Transparent"
                                CornerRadius="4"
                                Padding="0"
                                VerticalContentAlignment="Center"
                                HorizontalContentAlignment="Center">
                            <TextBlock Text="×" 
                                     Foreground="White"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- 中间内容区域 -->
            <Grid Grid.Row="1">
                <!-- 主页面按钮 -->
                <StackPanel IsVisible="{Binding Content, Converter={x:Static ObjectConverters.IsNull}}"
                            VerticalAlignment="Center" 
                            HorizontalAlignment="Center" 
                            Spacing="20">
                    
                    <Button Classes="MainButton"
                            Command="{Binding NavigateToTagWritingCommand}">
                        <Grid ColumnDefinitions="Auto,*" Width="140">
                            <PathIcon Grid.Column="0"
                                     Data="{StaticResource tag_regular}"
                                     Width="18" Height="18"
                                     Foreground="#1890ff"/>
                            <TextBlock Grid.Column="1"
                                      Text="标签编写" 
                                      VerticalAlignment="Center"
                                      HorizontalAlignment="Left"
                                      FontSize="14"
                                      Margin="15,0,0,0"
                                      Foreground="#333333"/>
                        </Grid>
                    </Button>

                    <Button Classes="MainButton"
                            Command="{Binding NavigateToNormalWorkCommand}">
                        <Grid ColumnDefinitions="Auto,*" Width="140">
                            <PathIcon Grid.Column="0"
                                     Data="{StaticResource person_regular}"
                                     Width="18" Height="18"
                                     Foreground="#1890ff"/>
                            <TextBlock Grid.Column="1"
                                      Text="馆员工作" 
                                      VerticalAlignment="Center"
                                      HorizontalAlignment="Left"
                                      FontSize="14"
                                      Margin="15,0,0,0"
                                      Foreground="#333333"/>
                        </Grid>
                    </Button>
                </StackPanel>

                <!-- 子页面内容 -->
                <ContentControl Content="{Binding Content}"
                                IsVisible="{Binding Content, Converter={x:Static ObjectConverters.IsNotNull}}">
                    <ContentControl.DataTemplates>
                        <DataTemplate DataType="{x:Type vm:TagWritingViewModel}">
                            <views:TagWritingView />
                        </DataTemplate>
                        <DataTemplate DataType="{x:Type vm:LoginViewModel}">
                            <views:LoginView />
                        </DataTemplate>
                        <DataTemplate DataType="{x:Type vm:DeviceSettingsViewModel}">
                            <views:DeviceSettingsView />
                        </DataTemplate>
                    </ContentControl.DataTemplates>
                </ContentControl>
            </Grid>

            <!-- 底部状态栏 -->
            <Border Grid.Row="2" 
                    Height="40"
                    Background="#f8f9fa"
                    CornerRadius="0,0,8,8">
                <Grid ColumnDefinitions="*,Auto">
                    <TextBlock Text="© 2024 图书馆自动化系统" 
                              Grid.Column="0"
                              Foreground="#666666"
                              FontSize="12"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center"/>
                    
                    <!-- 管理员按钮只在首页显示 -->
                    <Button Grid.Column="1"
                            Content="管理员" 
                            Command="{Binding ShowLoginCommand}"
                            Classes="TitleBarButton"
                            Foreground="#666666"
                            Background="Transparent"
                            Margin="0,0,20,0"
                            Width="60"
                            IsVisible="{Binding Content, Converter={x:Static ObjectConverters.IsNull}}"/>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
